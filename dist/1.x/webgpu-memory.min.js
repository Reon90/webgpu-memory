!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).webgpuMemory={})}(this,(function(t){"use strict";function e(t,e,r){const o={};for(const[n,s]of Object.entries(r)){const r={};for(let o=0;o<t.length;++o)r[t[o]]=s[o]??e[o];o[n]=r}return o}function r(t){return[...Object.keys(t)]}const o=e(["renderable","multisample","resolve","color","depth","stencil","storage","copySrc","copyDst","sampleType","bytesPerBlock","blockWidth","blockHeight","renderTargetPixelByteCost","renderTargetComponentAlignment","feature","baseFormat"],[,,,!0,!1,!1,,!0,!0,,,1,1,void 0,void 0,,void 0],{r8unorm:[!0,!0,!0,,,,!1,,,"float",1,,,1,1],r8snorm:[!1,!1,!1,,,,!1,,,"float",1],r8uint:[!0,!0,!1,,,,!1,,,"uint",1,,,1,1],r8sint:[!0,!0,!1,,,,!1,,,"sint",1,,,1,1],r16uint:[!0,!0,!1,,,,!1,,,"uint",2,,,2,2],r16sint:[!0,!0,!1,,,,!1,,,"sint",2,,,2,2],r16float:[!0,!0,!0,,,,!1,,,"float",2,,,2,2],rg8unorm:[!0,!0,!0,,,,!1,,,"float",2,,,2,1],rg8snorm:[!1,!1,!1,,,,!1,,,"float",2],rg8uint:[!0,!0,!1,,,,!1,,,"uint",2,,,2,1],rg8sint:[!0,!0,!1,,,,!1,,,"sint",2,,,2,1],r32uint:[!0,!1,!1,,,,!0,,,"uint",4,,,4,4],r32sint:[!0,!1,!1,,,,!0,,,"sint",4,,,4,4],r32float:[!0,!0,!1,,,,!0,,,"unfilterable-float",4,,,4,4],rg16uint:[!0,!0,!1,,,,!1,,,"uint",4,,,4,2],rg16sint:[!0,!0,!1,,,,!1,,,"sint",4,,,4,2],rg16float:[!0,!0,!0,,,,!1,,,"float",4,,,4,2],rgba8unorm:[!0,!0,!0,,,,!0,,,"float",4,,,8,1,,"rgba8unorm"],"rgba8unorm-srgb":[!0,!0,!0,,,,!1,,,"float",4,,,8,1,,"rgba8unorm"],rgba8snorm:[!1,!1,!1,,,,!0,,,"float",4],rgba8uint:[!0,!0,!1,,,,!0,,,"uint",4,,,4,1],rgba8sint:[!0,!0,!1,,,,!0,,,"sint",4,,,4,1],bgra8unorm:[!0,!0,!0,,,,!1,,,"float",4,,,8,1,,"bgra8unorm"],"bgra8unorm-srgb":[!0,!0,!0,,,,!1,,,"float",4,,,8,1,,"bgra8unorm"],rgb10a2unorm:[!0,!0,!0,,,,!1,,,"float",4,,,8,4],rg11b10ufloat:[!1,!1,!1,,,,!1,,,"float",4,,,8,4],rgb9e5ufloat:[!1,!1,!1,,,,!1,,,"float",4],rg32uint:[!0,!1,!1,,,,!0,,,"uint",8,,,8,4],rg32sint:[!0,!1,!1,,,,!0,,,"sint",8,,,8,4],rg32float:[!0,!1,!1,,,,!0,,,"unfilterable-float",8,,,8,4],rgba16uint:[!0,!0,!1,,,,!0,,,"uint",8,,,8,2],rgba16sint:[!0,!0,!1,,,,!0,,,"sint",8,,,8,2],rgba16float:[!0,!0,!0,,,,!0,,,"float",8,,,8,2],rgba32uint:[!0,!1,!1,,,,!0,,,"uint",16,,,16,4],rgba32sint:[!0,!1,!1,,,,!0,,,"sint",16,,,16,4],rgba32float:[!0,!1,!1,,,,!0,,,"unfilterable-float",16,,,16,4]}),n=["renderable","multisample","resolve","color","depth","stencil","storage","copySrc","copyDst","sampleType","bytesPerBlock","blockWidth","blockHeight","renderTargetPixelByteCost","renderTargetComponentAlignment","feature","baseFormat"],s=e(n,[!0,!0,!1,!1,,,!1,,,,,1,1,void 0,void 0,,void 0],{depth32float:[,,,,!0,!1,,!0,!1,"depth",4],depth16unorm:[,,,,!0,!1,,!0,!0,"depth",2],stencil8:[,,,,!1,!0,,!0,!0,"uint",1]}),c=e(n,[!0,!0,!1,!1,,,!1,!1,!1,,4,1,1,,,,void 0],{depth24plus:[,,,,!0,!1,,,,"depth"],"depth24plus-stencil8":[,,,,!0,!0,,,,"depth"],"depth32float-stencil8":[,,,,!0,!0,,,,"depth",5,,,,,"depth32float-stencil8"]}),a={...e(n,[!1,!1,!1,!0,!1,!1,!1,!0,!0,,,4,4,,,,void 0],{"bc1-rgba-unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-bc","bc1-rgba-unorm"],"bc1-rgba-unorm-srgb":[,,,,,,,,,"float",8,4,4,,,"texture-compression-bc","bc1-rgba-unorm"],"bc2-rgba-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc2-rgba-unorm"],"bc2-rgba-unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc2-rgba-unorm"],"bc3-rgba-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc3-rgba-unorm"],"bc3-rgba-unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc3-rgba-unorm"],"bc4-r-unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-bc"],"bc4-r-snorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-bc"],"bc5-rg-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc"],"bc5-rg-snorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc"],"bc6h-rgb-ufloat":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc"],"bc6h-rgb-float":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc"],"bc7-rgba-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc7-rgba-unorm"],"bc7-rgba-unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc7-rgba-unorm"]}),...e(n,[!1,!1,!1,!0,!1,!1,!1,!0,!0,,,4,4,,,,void 0],{"etc2-rgb8unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2","etc2-rgb8unorm"],"etc2-rgb8unorm-srgb":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2","etc2-rgb8unorm"],"etc2-rgb8a1unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2","etc2-rgb8a1unorm"],"etc2-rgb8a1unorm-srgb":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2","etc2-rgb8a1unorm"],"etc2-rgba8unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-etc2","etc2-rgba8unorm"],"etc2-rgba8unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-etc2","etc2-rgba8unorm"],"eac-r11unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2"],"eac-r11snorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2"],"eac-rg11unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-etc2"],"eac-rg11snorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-etc2"]}),...e(n,[!1,!1,!1,!0,!1,!1,!1,!0,!0,,,,,,,,void 0],{"astc-4x4-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-astc","astc-4x4-unorm"],"astc-4x4-unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-astc","astc-4x4-unorm"],"astc-5x4-unorm":[,,,,,,,,,"float",16,5,4,,,"texture-compression-astc","astc-5x4-unorm"],"astc-5x4-unorm-srgb":[,,,,,,,,,"float",16,5,4,,,"texture-compression-astc","astc-5x4-unorm"],"astc-5x5-unorm":[,,,,,,,,,"float",16,5,5,,,"texture-compression-astc","astc-5x5-unorm"],"astc-5x5-unorm-srgb":[,,,,,,,,,"float",16,5,5,,,"texture-compression-astc","astc-5x5-unorm"],"astc-6x5-unorm":[,,,,,,,,,"float",16,6,5,,,"texture-compression-astc","astc-6x5-unorm"],"astc-6x5-unorm-srgb":[,,,,,,,,,"float",16,6,5,,,"texture-compression-astc","astc-6x5-unorm"],"astc-6x6-unorm":[,,,,,,,,,"float",16,6,6,,,"texture-compression-astc","astc-6x6-unorm"],"astc-6x6-unorm-srgb":[,,,,,,,,,"float",16,6,6,,,"texture-compression-astc","astc-6x6-unorm"],"astc-8x5-unorm":[,,,,,,,,,"float",16,8,5,,,"texture-compression-astc","astc-8x5-unorm"],"astc-8x5-unorm-srgb":[,,,,,,,,,"float",16,8,5,,,"texture-compression-astc","astc-8x5-unorm"],"astc-8x6-unorm":[,,,,,,,,,"float",16,8,6,,,"texture-compression-astc","astc-8x6-unorm"],"astc-8x6-unorm-srgb":[,,,,,,,,,"float",16,8,6,,,"texture-compression-astc","astc-8x6-unorm"],"astc-8x8-unorm":[,,,,,,,,,"float",16,8,8,,,"texture-compression-astc","astc-8x8-unorm"],"astc-8x8-unorm-srgb":[,,,,,,,,,"float",16,8,8,,,"texture-compression-astc","astc-8x8-unorm"],"astc-10x5-unorm":[,,,,,,,,,"float",16,10,5,,,"texture-compression-astc","astc-10x5-unorm"],"astc-10x5-unorm-srgb":[,,,,,,,,,"float",16,10,5,,,"texture-compression-astc","astc-10x5-unorm"],"astc-10x6-unorm":[,,,,,,,,,"float",16,10,6,,,"texture-compression-astc","astc-10x6-unorm"],"astc-10x6-unorm-srgb":[,,,,,,,,,"float",16,10,6,,,"texture-compression-astc","astc-10x6-unorm"],"astc-10x8-unorm":[,,,,,,,,,"float",16,10,8,,,"texture-compression-astc","astc-10x8-unorm"],"astc-10x8-unorm-srgb":[,,,,,,,,,"float",16,10,8,,,"texture-compression-astc","astc-10x8-unorm"],"astc-10x10-unorm":[,,,,,,,,,"float",16,10,10,,,"texture-compression-astc","astc-10x10-unorm"],"astc-10x10-unorm-srgb":[,,,,,,,,,"float",16,10,10,,,"texture-compression-astc","astc-10x10-unorm"],"astc-12x10-unorm":[,,,,,,,,,"float",16,12,10,,,"texture-compression-astc","astc-12x10-unorm"],"astc-12x10-unorm-srgb":[,,,,,,,,,"float",16,12,10,,,"texture-compression-astc","astc-12x10-unorm"],"astc-12x12-unorm":[,,,,,,,,,"float",16,12,12,,,"texture-compression-astc","astc-12x12-unorm"],"astc-12x12-unorm-srgb":[,,,,,,,,,"float",16,12,12,,,"texture-compression-astc","astc-12x12-unorm"]})},u={...o,...a},i={...o,...s},m={...o,...s,...a},l={...s,...c},f={...o,...s,...c},b={...f,...a},p=r(o);r(s),r(c),r(a),r(u),r(i),r(m),r(l),r(f),r(b),p.filter((t=>u[t].renderable));const x=b,g=Symbol("webgpu-memory-object-id"),d=new Map;let y=1;const P=new Map;function h(t,e,r,o){const n=y++;e[g]=n,P.set(n,{ref:new WeakRef(e),id:n,deviceId:t[g],category:r,size:o})}function G(t,e,r,o){h(t,e,r,o)}function v(t){const e=d.get(t);return e&&!!e.deref()}function U(t){P.delete(t)}function D(t,e){U(t[g])}function k(t,e,r){const o=t.prototype[e];t.prototype[e]=function(...t){const e=o.call(this,...t);return void 0!==e&&"function"==typeof e.then?e.then((e=>r(this,e,...t))):r(this,e,...t),e}}function B(t,e,r,o){k(t,r,(function(t,e){h(t,e,o)})),e.prototype.destroy&&k(e,"destroy",(function(t){D(t)}))}k(GPUAdapter,"requestDevice",(function(t,e){const r=y++;e[g]=r,d.set(r,new WeakRef(e))})),k(GPUDevice,"destroy",(function(t){const e=t[g];d.delete(e)})),k(GPUDevice,"createBuffer",(function(t,e){G(t,e,"buffer",e.size)})),k(GPUBuffer,"destroy",(function(t){D(t)})),k(GPUDevice,"createTexture",(function(t,e){const r=function(t){const{blockWidth:e,blockHeight:r,bytesPerBlock:o}=x[t.format];let n=0;t.width,t.height,"3d"!==t.dimension||t.depthOrArrayLayers;const s="3d"===t.dimension?1:t.depthOrArrayLayers;for(let s=0;s<t.mipLevelCount;++s)n+=Math.ceil(t.width*t.sampleCount/e)*Math.ceil(t.height*t.sampleCount/r)*o;return n*=s,n}(e);G(t,e,"texture",r)})),k(GPUTexture,"destroy",(function(t){D(t)})),B(GPUDevice,GPUSampler,"createSampler","sampler"),B(GPUDevice,GPUBindGroup,"createBindGroup","bindGroup"),B(GPUDevice,GPUBindGroupLayout,"createBindGroupLayout","bindGroupLayout"),B(GPUDevice,GPUPipelineLayout,"createPipelineLayout","pipelineLayout"),B(GPUDevice,GPUShaderModule,"createShaderModule","shaderModule"),B(GPUDevice,GPUComputePipeline,"createComputePipeline","computePipeline"),B(GPUDevice,GPURenderPipeline,"createRenderPipeline","renderPipeline"),B(GPUDevice,GPUComputePipeline,"createComputePipelineAsync","computePipeline"),B(GPUDevice,GPURenderPipeline,"createRenderPipelineAsync","renderPipeline"),B(GPUDevice,GPUQuerySet,"createQuerySet","querySet"),t.getWebGPUMemoryUsage=function(t){const e={total:0,buffer:0,texture:0},r={buffer:0,texture:0},o={memory:e,resources:r},n=t&&t[g],s=[];for(const[t,{ref:o,deviceId:c,category:a,size:u}]of P.entries())o.deref()&&v(c)?n&&c!==n||(r[a]=(r[a]||0)+1,u&&(e.total+=u,e[a]+=u)):s.push(t);return s.forEach(U),o}}));
//# sourceMappingURL=webgpu-memory.min.js.map
