!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((t="undefined"!=typeof globalThis?globalThis:t||self).webgpuMemory={})}(this,(function(t){"use strict";function o(t,o,r){const e={};for(const[s,n]of Object.entries(r)){const r={};for(let e=0;e<t.length;++e)r[t[e]]=n[e]??o[e];e[s]=r}return e}function r(t){return[...Object.keys(t)]}const e=o(["renderable","multisample","resolve","color","depth","stencil","storage","copySrc","copyDst","sampleType","bytesPerBlock","blockWidth","blockHeight","renderTargetPixelByteCost","renderTargetComponentAlignment","feature","baseFormat"],[,,,!0,!1,!1,,!0,!0,,,1,1,void 0,void 0,,void 0],{r8unorm:[!0,!0,!0,,,,!1,,,"float",1,,,1,1],r8snorm:[!1,!1,!1,,,,!1,,,"float",1],r8uint:[!0,!0,!1,,,,!1,,,"uint",1,,,1,1],r8sint:[!0,!0,!1,,,,!1,,,"sint",1,,,1,1],r16uint:[!0,!0,!1,,,,!1,,,"uint",2,,,2,2],r16sint:[!0,!0,!1,,,,!1,,,"sint",2,,,2,2],r16float:[!0,!0,!0,,,,!1,,,"float",2,,,2,2],rg8unorm:[!0,!0,!0,,,,!1,,,"float",2,,,2,1],rg8snorm:[!1,!1,!1,,,,!1,,,"float",2],rg8uint:[!0,!0,!1,,,,!1,,,"uint",2,,,2,1],rg8sint:[!0,!0,!1,,,,!1,,,"sint",2,,,2,1],r32uint:[!0,!1,!1,,,,!0,,,"uint",4,,,4,4],r32sint:[!0,!1,!1,,,,!0,,,"sint",4,,,4,4],r32float:[!0,!0,!1,,,,!0,,,"unfilterable-float",4,,,4,4],rg16uint:[!0,!0,!1,,,,!1,,,"uint",4,,,4,2],rg16sint:[!0,!0,!1,,,,!1,,,"sint",4,,,4,2],rg16float:[!0,!0,!0,,,,!1,,,"float",4,,,4,2],rgba8unorm:[!0,!0,!0,,,,!0,,,"float",4,,,8,1,,"rgba8unorm"],"rgba8unorm-srgb":[!0,!0,!0,,,,!1,,,"float",4,,,8,1,,"rgba8unorm"],rgba8snorm:[!1,!1,!1,,,,!0,,,"float",4],rgba8uint:[!0,!0,!1,,,,!0,,,"uint",4,,,4,1],rgba8sint:[!0,!0,!1,,,,!0,,,"sint",4,,,4,1],bgra8unorm:[!0,!0,!0,,,,!1,,,"float",4,,,8,1,,"bgra8unorm"],"bgra8unorm-srgb":[!0,!0,!0,,,,!1,,,"float",4,,,8,1,,"bgra8unorm"],rgb10a2unorm:[!0,!0,!0,,,,!1,,,"float",4,,,8,4],rg11b10ufloat:[!1,!1,!1,,,,!1,,,"float",4,,,8,4],rgb9e5ufloat:[!1,!1,!1,,,,!1,,,"float",4],rg32uint:[!0,!1,!1,,,,!0,,,"uint",8,,,8,4],rg32sint:[!0,!1,!1,,,,!0,,,"sint",8,,,8,4],rg32float:[!0,!1,!1,,,,!0,,,"unfilterable-float",8,,,8,4],rgba16uint:[!0,!0,!1,,,,!0,,,"uint",8,,,8,2],rgba16sint:[!0,!0,!1,,,,!0,,,"sint",8,,,8,2],rgba16float:[!0,!0,!0,,,,!0,,,"float",8,,,8,2],rgba32uint:[!0,!1,!1,,,,!0,,,"uint",16,,,16,4],rgba32sint:[!0,!1,!1,,,,!0,,,"sint",16,,,16,4],rgba32float:[!0,!1,!1,,,,!0,,,"unfilterable-float",16,,,16,4]}),s=["renderable","multisample","resolve","color","depth","stencil","storage","copySrc","copyDst","sampleType","bytesPerBlock","blockWidth","blockHeight","renderTargetPixelByteCost","renderTargetComponentAlignment","feature","baseFormat"],n=o(s,[!0,!0,!1,!1,,,!1,,,,,1,1,void 0,void 0,,void 0],{depth32float:[,,,,!0,!1,,!0,!1,"depth",4],depth16unorm:[,,,,!0,!1,,!0,!0,"depth",2],stencil8:[,,,,!1,!0,,!0,!0,"uint",1]}),c=o(s,[!0,!0,!1,!1,,,!1,!1,!1,,4,1,1,,,,void 0],{depth24plus:[,,,,!0,!1,,,,"depth"],"depth24plus-stencil8":[,,,,!0,!0,,,,"depth"],"depth32float-stencil8":[,,,,!0,!0,,,,"depth",5,,,,,"depth32float-stencil8"]}),a={...o(s,[!1,!1,!1,!0,!1,!1,!1,!0,!0,,,4,4,,,,void 0],{"bc1-rgba-unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-bc","bc1-rgba-unorm"],"bc1-rgba-unorm-srgb":[,,,,,,,,,"float",8,4,4,,,"texture-compression-bc","bc1-rgba-unorm"],"bc2-rgba-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc2-rgba-unorm"],"bc2-rgba-unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc2-rgba-unorm"],"bc3-rgba-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc3-rgba-unorm"],"bc3-rgba-unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc3-rgba-unorm"],"bc4-r-unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-bc"],"bc4-r-snorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-bc"],"bc5-rg-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc"],"bc5-rg-snorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc"],"bc6h-rgb-ufloat":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc"],"bc6h-rgb-float":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc"],"bc7-rgba-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc7-rgba-unorm"],"bc7-rgba-unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-bc","bc7-rgba-unorm"]}),...o(s,[!1,!1,!1,!0,!1,!1,!1,!0,!0,,,4,4,,,,void 0],{"etc2-rgb8unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2","etc2-rgb8unorm"],"etc2-rgb8unorm-srgb":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2","etc2-rgb8unorm"],"etc2-rgb8a1unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2","etc2-rgb8a1unorm"],"etc2-rgb8a1unorm-srgb":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2","etc2-rgb8a1unorm"],"etc2-rgba8unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-etc2","etc2-rgba8unorm"],"etc2-rgba8unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-etc2","etc2-rgba8unorm"],"eac-r11unorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2"],"eac-r11snorm":[,,,,,,,,,"float",8,4,4,,,"texture-compression-etc2"],"eac-rg11unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-etc2"],"eac-rg11snorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-etc2"]}),...o(s,[!1,!1,!1,!0,!1,!1,!1,!0,!0,,,,,,,,void 0],{"astc-4x4-unorm":[,,,,,,,,,"float",16,4,4,,,"texture-compression-astc","astc-4x4-unorm"],"astc-4x4-unorm-srgb":[,,,,,,,,,"float",16,4,4,,,"texture-compression-astc","astc-4x4-unorm"],"astc-5x4-unorm":[,,,,,,,,,"float",16,5,4,,,"texture-compression-astc","astc-5x4-unorm"],"astc-5x4-unorm-srgb":[,,,,,,,,,"float",16,5,4,,,"texture-compression-astc","astc-5x4-unorm"],"astc-5x5-unorm":[,,,,,,,,,"float",16,5,5,,,"texture-compression-astc","astc-5x5-unorm"],"astc-5x5-unorm-srgb":[,,,,,,,,,"float",16,5,5,,,"texture-compression-astc","astc-5x5-unorm"],"astc-6x5-unorm":[,,,,,,,,,"float",16,6,5,,,"texture-compression-astc","astc-6x5-unorm"],"astc-6x5-unorm-srgb":[,,,,,,,,,"float",16,6,5,,,"texture-compression-astc","astc-6x5-unorm"],"astc-6x6-unorm":[,,,,,,,,,"float",16,6,6,,,"texture-compression-astc","astc-6x6-unorm"],"astc-6x6-unorm-srgb":[,,,,,,,,,"float",16,6,6,,,"texture-compression-astc","astc-6x6-unorm"],"astc-8x5-unorm":[,,,,,,,,,"float",16,8,5,,,"texture-compression-astc","astc-8x5-unorm"],"astc-8x5-unorm-srgb":[,,,,,,,,,"float",16,8,5,,,"texture-compression-astc","astc-8x5-unorm"],"astc-8x6-unorm":[,,,,,,,,,"float",16,8,6,,,"texture-compression-astc","astc-8x6-unorm"],"astc-8x6-unorm-srgb":[,,,,,,,,,"float",16,8,6,,,"texture-compression-astc","astc-8x6-unorm"],"astc-8x8-unorm":[,,,,,,,,,"float",16,8,8,,,"texture-compression-astc","astc-8x8-unorm"],"astc-8x8-unorm-srgb":[,,,,,,,,,"float",16,8,8,,,"texture-compression-astc","astc-8x8-unorm"],"astc-10x5-unorm":[,,,,,,,,,"float",16,10,5,,,"texture-compression-astc","astc-10x5-unorm"],"astc-10x5-unorm-srgb":[,,,,,,,,,"float",16,10,5,,,"texture-compression-astc","astc-10x5-unorm"],"astc-10x6-unorm":[,,,,,,,,,"float",16,10,6,,,"texture-compression-astc","astc-10x6-unorm"],"astc-10x6-unorm-srgb":[,,,,,,,,,"float",16,10,6,,,"texture-compression-astc","astc-10x6-unorm"],"astc-10x8-unorm":[,,,,,,,,,"float",16,10,8,,,"texture-compression-astc","astc-10x8-unorm"],"astc-10x8-unorm-srgb":[,,,,,,,,,"float",16,10,8,,,"texture-compression-astc","astc-10x8-unorm"],"astc-10x10-unorm":[,,,,,,,,,"float",16,10,10,,,"texture-compression-astc","astc-10x10-unorm"],"astc-10x10-unorm-srgb":[,,,,,,,,,"float",16,10,10,,,"texture-compression-astc","astc-10x10-unorm"],"astc-12x10-unorm":[,,,,,,,,,"float",16,12,10,,,"texture-compression-astc","astc-12x10-unorm"],"astc-12x10-unorm-srgb":[,,,,,,,,,"float",16,12,10,,,"texture-compression-astc","astc-12x10-unorm"],"astc-12x12-unorm":[,,,,,,,,,"float",16,12,12,,,"texture-compression-astc","astc-12x12-unorm"],"astc-12x12-unorm-srgb":[,,,,,,,,,"float",16,12,12,,,"texture-compression-astc","astc-12x12-unorm"]})},u={...e,...a},m={...e,...n},i={...e,...n,...a},l={...n,...c},f={...e,...n,...c},b={...f,...a},x=r(e);r(n),r(c),r(a),r(u),r(m),r(i),r(l),r(f),r(b),x.filter((t=>u[t].renderable));const g=b,p=Symbol("webgpu-memory-object-id"),d=new Map;let h=1;const y=new Map;function v(t,o,r,e){const s=h++;o[p]=s,y.set(s,{ref:new WeakRef(o),id:s,deviceId:t[p],category:r,size:e})}function k(t){const o=d.get(t);return o&&!!o.deref()}function P(t){y.delete(t)}function T(t,o){P(t[p])}function w(t,o,r){const e=t.prototype[o];t.prototype[o]=function(...t){const o=e.call(this,...t);return void 0!==o&&"function"==typeof o.then?o.then((o=>r(this,o,...t))):r(this,o,...t),o}}w(GPUAdapter,"requestDevice",(function(t,o){const r=h++;o[p]=r,d.set(r,new WeakRef(o))})),w(GPUDevice,"destroy",(function(t){const o=t[p];d.delete(o)})),w(GPUDevice,"createBuffer",(function(t,o){v(t,o,"buffer",o.size)})),w(GPUBuffer,"destroy",(function(t){T(t)})),w(GPUDevice,"createTexture",(function(t,o){const r=function(t){const{blockWidth:o,blockHeight:r,bytesPerBlock:e}=g[t.format];let s=0;t.width,t.height,"3d"!==t.dimension||t.depthOrArrayLayers;const n="3d"===t.dimension?1:t.depthOrArrayLayers;for(let n=0;n<t.mipLevelCount;++n)s+=Math.ceil(t.width*t.sampleCount/o)*Math.ceil(t.height*t.sampleCount/r)*e;return s*=n,s}(o);v(t,o,"texture",r)})),w(GPUTexture,"destroy",(function(t){T(t)})),t.getWebGPUMemoryUsage=function(t){const o={total:0,buffer:0,texture:0},r={buffer:0,texture:0},e={memory:o,resources:r},s=t&&t[p],n=[];for(const[t,{ref:e,deviceId:c,category:a,size:u}]of y.entries())e.deref()&&k(c)?s&&c!==s||(r[a]++,o.total+=u,o[a]+=u):n.push(t);return n.forEach(P),e}}));
//# sourceMappingURL=webgpu-memory.min.js.map
